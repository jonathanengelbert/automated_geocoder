# -*- coding: utf-8 -*-
# ---------------------------------------------------------------------------
# geocoding.py
# Created on: 2018-02-23 10:51:03.00000
#   (generated by ArcGIS/ModelBuilder)
# Description: 
# ---------------------------------------------------------------------------

# Import arcpy module
import arcpy
arcpy.env.overwriteOutput = True

def geocode():
    # Local variables:
    AddressLocator_Street_Centerlines = "I:\\GIS\\OASIS\\AddressLocators\\AddressLocator_Street_Centerlines"
    transformed_xlsx = "I:\\GIS\\OASIS\\Geocoder\\transformed.xlsx"
    transfomed = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\transfomed"
    AddressLocator_Master_Address_Database = "I:\\GIS\\OASIS\\AddressLocators\\AddressLocator_Master_Address_Database"
    geocoded_addresses = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses"
    geocoder_gdb = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb"
    geocoded_master_successful = "geocoded_master_successful"
    geocoded_master_successful__2_ = geocoded_master_successful
    geocoded_master_successful__4_ = geocoded_master_successful__2_
    geocoder_gdb__2_ = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb"
    geocoded_addresses_failed = "geocoded_addresses_failed"
    geocoder_gdb__3_ = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb"
    failed_table = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\failed_table"
    failed_table__2_ = failed_table
    AddressLocator_Street_Centerlines__2_ = "I:\\GIS\\OASIS\\AddressLocators\\AddressLocator_Street_Centerlines"
    geocoded_street_centerlines = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_street_centerlines"
    geocoder_gdb__4_ = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb"
    geocoded_street_centerlines_successful = "geocoded_street_centerlines_successful"
    geocoded_street_centerlines_successful__2_ = geocoded_street_centerlines_successful
    geocoded_street_centerlines_successful__3_ = geocoded_street_centerlines_successful__2_
    final = "I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\final"


    # Process: Excel To Table
    arcpy.ExcelToTable_conversion(transformed_xlsx, transfomed, "")

    # Process: Geocode Addresses
    arcpy.GeocodeAddresses_geocoding(transfomed, AddressLocator_Master_Address_Database, "Key transformed_address VISIBLE NONE", geocoded_addresses, "STATIC", "", "ROUTING_LOCATION")

    # Process: Make Feature Layer (2)
    arcpy.MakeFeatureLayer_management(geocoded_addresses, geocoded_master_successful, "Status = 'M'  OR  Status = 'T'", geocoder_gdb, "ObjectID OBJECTID VISIBLE NONE;Shape Shape VISIBLE NONE;Status Status VISIBLE NONE;Score Score VISIBLE NONE;Match_type Match_type VISIBLE NONE;Match_addr Match_addr VISIBLE NONE;X X VISIBLE NONE;Y Y VISIBLE NONE;Xmin Xmin VISIBLE NONE;Xmax Xmax VISIBLE NONE;Ymin Ymin VISIBLE NONE;Ymax Ymax VISIBLE NONE;Addr_type Addr_type VISIBLE NONE;ARC_SingleKey ARC_SingleKey VISIBLE NONE")

    # Process: Add Field
    arcpy.AddField_management(geocoded_master_successful, "geocoder", "TEXT", "", "", "20", "", "NULLABLE", "NON_REQUIRED", "")

    # Process: Calculate Field
    arcpy.CalculateField_management(geocoded_master_successful__2_, "geocoder", "\"EAS\"", "PYTHON", "")

    # Process: Make Feature Layer
    arcpy.MakeFeatureLayer_management(geocoded_addresses, geocoded_addresses_failed, "Status = 'U'", geocoder_gdb__2_, "ObjectID OBJECTID VISIBLE NONE;Shape Shape VISIBLE NONE;Status Status VISIBLE NONE;Score Score VISIBLE NONE;Match_type Match_type VISIBLE NONE;Match_addr Match_addr VISIBLE NONE;X X VISIBLE NONE;Y Y VISIBLE NONE;Xmin Xmin VISIBLE NONE;Xmax Xmax VISIBLE NONE;Ymin Ymin VISIBLE NONE;Ymax Ymax VISIBLE NONE;Addr_type Addr_type VISIBLE NONE;ARC_SingleKey ARC_SingleKey VISIBLE NONE")

    # Process: Table to Table
    arcpy.TableToTable_conversion(geocoded_addresses_failed, geocoder_gdb__3_, "failed_table", "", "Status \"Status\" true true false 1 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Status,-1,-1;Score \"Score\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Score,-1,-1;Match_type \"Match_type\" true true false 2 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Match_type,-1,-1;Match_addr \"Match_addr\" true true false 120 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Match_addr,-1,-1;X \"X\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,X,-1,-1;Y \"Y\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Y,-1,-1;Xmin \"Xmin\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Xmin,-1,-1;Xmax \"Xmax\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Xmax,-1,-1;Ymin \"Ymin\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Ymin,-1,-1;Ymax \"Ymax\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Ymax,-1,-1;Addr_type \"Addr_type\" true true false 20 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Addr_type,-1,-1;ARC_Single_Line_Input \"Key\" true true false 100 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,ARC_Single_Line_Input,-1,-1;ST_NAME \"ST_NAME\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,ST_NAME,-1,-1;EXT \"EXT\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,EXT,-1,-1;NUM \"NUM\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,NUM,-1,-1;LETTER \"LETTER\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,LETTER,-1,-1;UNIT \"UNIT\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,UNIT,-1,-1;Address \"Address\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,Address,-1,-1;DBA \"DBA\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,DBA,-1,-1;OWNER \"OWNER\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,OWNER,-1,-1;ZIP \"ZIP\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,ZIP,-1,-1;LONGITUDE \"LONGITUDE\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,LONGITUDE,-1,-1;LATITUDE \"LATITUDE\" true true false 8 Double 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,LATITUDE,-1,-1;DISTRICT \"DISTRICT\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,DISTRICT,-1,-1;LOC_ID_NO \"LOC_ID_NO\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,LOC_ID_NO,-1,-1;CERT_NO \"CERT_NO\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,CERT_NO,-1,-1;H31_ACCOUNT_NO \"H31_ACCOUNT_NO\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,H31_ACCOUNT_NO,-1,-1;PERMIT_NO \"PERMIT NO\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,PERMIT_NO,-1,-1;BOE_NO \"BOE_NO\" true true false 4 Long 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,BOE_NO,-1,-1;DATE_ISSUED \"DATE_ISSUED\" true true false 8 Date 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,DATE_ISSUED,-1,-1;LAST_ROUTINE \"LAST_ROUTINE\" true true false 8 Date 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,LAST_ROUTINE,-1,-1;transformed_address \"transformed_address\" true true false 255 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,transformed_address,-1,-1;geocoder \"geocoder\" true true false 20 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,geocoder,-1,-1;ARC_SingleKey \"Key\" true true false 100 Text 0 0 ,First,#,I:\\GIS\\OASIS\\Geocoder\\geocoder.gdb\\geocoded_addresses,ARC_SingleKey,-1,-1", "")

    # Process: Delete Field
    arcpy.DeleteField_management(failed_table, "ARC_Single_Line_Input")

    # Process: Geocode Addresses (2)
    arcpy.GeocodeAddresses_geocoding(failed_table__2_, AddressLocator_Street_Centerlines__2_, "'Full Address' transformed_address VISIBLE NONE", geocoded_street_centerlines, "STATIC", "", "")

    # Process: Make Feature Layer (3)
    arcpy.MakeFeatureLayer_management(geocoded_street_centerlines, geocoded_street_centerlines_successful, "", geocoder_gdb__4_, "ObjectID OBJECTID VISIBLE NONE;Shape Shape VISIBLE NONE;Status Status VISIBLE NONE;Score Score VISIBLE NONE;Match_type Match_type VISIBLE NONE;Match_addr Match_addr VISIBLE NONE;Side Side VISIBLE NONE;Ref_ID Ref_ID VISIBLE NONE;User_fld User_fld VISIBLE NONE;Addr_type Addr_type VISIBLE NONE;ARC_Single_Line_Input ARC_Single_Line_Input VISIBLE NONE;Status_1 Status_1 VISIBLE NONE;Score_1 Score_1 VISIBLE NONE;Match_type_1 Match_type_1 VISIBLE NONE;Match_addr_1 Match_addr_1 VISIBLE NONE;X X VISIBLE NONE;Y Y VISIBLE NONE;Xmin Xmin VISIBLE NONE;Xmax Xmax VISIBLE NONE;Ymin Ymin VISIBLE NONE;Ymax Ymax VISIBLE NONE;Addr_type_1 Addr_type_1 VISIBLE NONE;ST_NAME ST_NAME VISIBLE NONE;EXT EXT VISIBLE NONE;NUM NUM VISIBLE NONE;LETTER LETTER VISIBLE NONE;UNIT UNIT VISIBLE NONE;Address Address VISIBLE NONE;DBA DBA VISIBLE NONE;OWNER OWNER VISIBLE NONE;ZIP ZIP VISIBLE NONE;LONGITUDE LONGITUDE VISIBLE NONE;LATITUDE LATITUDE VISIBLE NONE;DISTRICT DISTRICT VISIBLE NONE;LOC_ID_NO LOC_ID_NO VISIBLE NONE;CERT_NO CERT_NO VISIBLE NONE;H31_ACCOUNT_NO H31_ACCOUNT_NO VISIBLE NONE;PERMIT_NO PERMIT_NO VISIBLE NONE;BOE_NO BOE_NO VISIBLE NONE;DATE_ISSUED DATE_ISSUED VISIBLE NONE;LAST_ROUTINE LAST_ROUTINE VISIBLE NONE;transformed_address transformed_address VISIBLE NONE;geocoder geocoder VISIBLE NONE;ARC_SingleKey ARC_SingleKey VISIBLE NONE")

    # Process: Add Field (2)
    arcpy.AddField_management(geocoded_street_centerlines_successful, "geocoder", "TEXT", "", "", "", "", "NULLABLE", "NON_REQUIRED", "")

    # Process: Calculate Field (2)
    arcpy.CalculateField_management(geocoded_street_centerlines_successful__2_, "geocoder", "classifyGeocoder(!Status!)", "PYTHON", "def classifyGeocoder(Status):\\n  if Status == \"M\" or Status == \"T\":\\n   return \"SC\"\\n  else:\\n    return \"U\"")

    # Process: Merge
    arcpy.Merge_management("geocoded_master_successful;geocoded_street_centerlines_successful", final, "Status \"Status\" true true false 1 Text 0 0 ,First,#,geocoded_master_successful,Status,-1,-1,geocoded_street_centerlines_successful,Status,-1,-1;Score \"Score\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Score,-1,-1,geocoded_street_centerlines_successful,Score,-1,-1;Match_type \"Match_type\" true true false 2 Text 0 0 ,First,#,geocoded_master_successful,Match_type,-1,-1,geocoded_street_centerlines_successful,Match_type,-1,-1;Match_addr \"Match_addr\" true true false 120 Text 0 0 ,First,#,geocoded_master_successful,Match_addr,-1,-1,geocoded_street_centerlines_successful,Match_addr,-1,-1;X \"X\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,X,-1,-1,geocoded_street_centerlines_successful,X,-1,-1;Y \"Y\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Y,-1,-1,geocoded_street_centerlines_successful,Y,-1,-1;Xmin \"Xmin\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Xmin,-1,-1,geocoded_street_centerlines_successful,Xmin,-1,-1;Xmax \"Xmax\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Xmax,-1,-1,geocoded_street_centerlines_successful,Xmax,-1,-1;Ymin \"Ymin\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Ymin,-1,-1,geocoded_street_centerlines_successful,Ymin,-1,-1;Ymax \"Ymax\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,Ymax,-1,-1,geocoded_street_centerlines_successful,Ymax,-1,-1;Addr_type \"Addr_type\" true true false 20 Text 0 0 ,First,#,geocoded_master_successful,Addr_type,-1,-1,geocoded_street_centerlines_successful,Addr_type,-1,-1;ARC_Single_Line_Input \"Key\" true true false 100 Text 0 0 ,First,#,geocoded_master_successful,ARC_Single_Line_Input,-1,-1,geocoded_street_centerlines_successful,ARC_Single_Line_Input,-1,-1;ST_NAME \"ST_NAME\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,ST_NAME,-1,-1,geocoded_street_centerlines_successful,ST_NAME,-1,-1;EXT \"EXT\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,EXT,-1,-1,geocoded_street_centerlines_successful,EXT,-1,-1;NUM \"NUM\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,NUM,-1,-1,geocoded_street_centerlines_successful,NUM,-1,-1;LETTER \"LETTER\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,LETTER,-1,-1,geocoded_street_centerlines_successful,LETTER,-1,-1;UNIT \"UNIT\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,UNIT,-1,-1,geocoded_street_centerlines_successful,UNIT,-1,-1;Address \"Address\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,Address,-1,-1,geocoded_street_centerlines_successful,Address,-1,-1;DBA \"DBA\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,DBA,-1,-1,geocoded_street_centerlines_successful,DBA,-1,-1;OWNER \"OWNER\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,OWNER,-1,-1,geocoded_street_centerlines_successful,OWNER,-1,-1;ZIP \"ZIP\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,ZIP,-1,-1,geocoded_street_centerlines_successful,ZIP,-1,-1;LONGITUDE \"LONGITUDE\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,LONGITUDE,-1,-1,geocoded_street_centerlines_successful,LONGITUDE,-1,-1;LATITUDE \"LATITUDE\" true true false 8 Double 0 0 ,First,#,geocoded_master_successful,LATITUDE,-1,-1,geocoded_street_centerlines_successful,LATITUDE,-1,-1;DISTRICT \"DISTRICT\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,DISTRICT,-1,-1,geocoded_street_centerlines_successful,DISTRICT,-1,-1;LOC_ID_NO \"LOC_ID_NO\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,LOC_ID_NO,-1,-1,geocoded_street_centerlines_successful,LOC_ID_NO,-1,-1;CERT_NO \"CERT_NO\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,CERT_NO,-1,-1,geocoded_street_centerlines_successful,CERT_NO,-1,-1;H31_ACCOUNT_NO \"H31_ACCOUNT_NO\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,H31_ACCOUNT_NO,-1,-1,geocoded_street_centerlines_successful,H31_ACCOUNT_NO,-1,-1;PERMIT_NO \"PERMIT NO\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,PERMIT_NO,-1,-1,geocoded_street_centerlines_successful,PERMIT_NO,-1,-1;BOE_NO \"BOE_NO\" true true false 4 Long 0 0 ,First,#,geocoded_master_successful,BOE_NO,-1,-1,geocoded_street_centerlines_successful,BOE_NO,-1,-1;DATE_ISSUED \"DATE_ISSUED\" true true false 8 Date 0 0 ,First,#,geocoded_master_successful,DATE_ISSUED,-1,-1,geocoded_street_centerlines_successful,DATE_ISSUED,-1,-1;LAST_ROUTINE \"LAST_ROUTINE\" true true false 8 Date 0 0 ,First,#,geocoded_master_successful,LAST_ROUTINE,-1,-1,geocoded_street_centerlines_successful,LAST_ROUTINE,-1,-1;transformed_address \"transformed_address\" true true false 255 Text 0 0 ,First,#,geocoded_master_successful,transformed_address,-1,-1,geocoded_street_centerlines_successful,transformed_address,-1,-1;geocoder \"geocoder\" true true false 20 Text 0 0 ,First,#,geocoded_master_successful,geocoder,-1,-1,geocoded_street_centerlines_successful,geocoder,-1,-1;ARC_SingleKey \"Key\" true true false 100 Text 0 0 ,First,#,geocoded_master_successful,ARC_SingleKey,-1,-1,geocoded_street_centerlines_successful,ARC_SingleKey,-1,-1;Side \"Side\" true true false 1 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Side,-1,-1;Ref_ID \"Ref_ID\" true true false 50 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Ref_ID,-1,-1;User_fld \"User_fld\" true true false 120 Text 0 0 ,First,#,geocoded_street_centerlines_successful,User_fld,-1,-1;Status_1 \"Status\" true true false 1 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Status_1,-1,-1;Score_1 \"Score\" true true false 8 Double 0 0 ,First,#,geocoded_street_centerlines_successful,Score_1,-1,-1;Match_type_1 \"Match_type_1\" true true false 2 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Match_type_1,-1,-1;Match_addr_1 \"Match_addr\" true true false 120 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Match_addr_1,-1,-1;Addr_type_1 \"Addr_type\" true true false 20 Text 0 0 ,First,#,geocoded_street_centerlines_successful,Addr_type_1,-1,-1")

    del geocoded_addresses_failed
    del geocoded_street_centerlines_successful
    del geocoded_master_successful

    
if __name__ == "__main__":
    geocode()
    print("\nAddresses Processed")
    exit()


